<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Gem5 Basics | Ziang Tian's Personal Blogs</title><meta name="author" content="Ziang Tian"><meta name="copyright" content="Ziang Tian"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="I’ve been trying to simulate a somewhat complicated cache system, and my advisor suggested that i should do it with gem5, which required me to learn this simulator. I’m primarily learning from the off">
<meta property="og:type" content="article">
<meta property="og:title" content="Gem5 Basics">
<meta property="og:url" content="http://ziangtian.github.io/personal/2024/05/05/gem5-basics/index.html">
<meta property="og:site_name" content="Ziang Tian&#39;s Personal Blogs">
<meta property="og:description" content="I’ve been trying to simulate a somewhat complicated cache system, and my advisor suggested that i should do it with gem5, which required me to learn this simulator. I’m primarily learning from the off">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://ziangtian.github.io/personal/img/pfp.jpg">
<meta property="article:published_time" content="2024-05-05T14:41:01.000Z">
<meta property="article:modified_time" content="2024-05-08T03:47:08.085Z">
<meta property="article:author" content="Ziang Tian">
<meta property="article:tag" content="gem5">
<meta property="article:tag" content="arch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://ziangtian.github.io/personal/img/pfp.jpg"><link rel="shortcut icon" href="/personal/img/favicon.png"><link rel="canonical" href="http://ziangtian.github.io/personal/2024/05/05/gem5-basics/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/personal/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/personal/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Gem5 Basics',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-08 11:47:08'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/widen.css"><meta name="generator" content="Hexo 7.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/personal/img/pfp.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/personal/archives/"><div class="headline">Articles</div><div class="length-num">4</div></a><a href="/personal/tags/"><div class="headline">Tags</div><div class="length-num">5</div></a><a href="/personal/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/personal/archives/"><span> 🗃️Archives</span></a></div><div class="menus_item"><a class="site-page" href="https://ziangtian.github.io"><span> 📊Academic Page</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/personal/img/ambient.jpg')"><nav id="nav"><span id="blog-info"><a href="/personal/" title="Ziang Tian's Personal Blogs"><span class="site-name">Ziang Tian's Personal Blogs</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/personal/archives/"><span> 🗃️Archives</span></a></div><div class="menus_item"><a class="site-page" href="https://ziangtian.github.io"><span> 📊Academic Page</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Gem5 Basics</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2024-05-05T14:41:01.000Z" title="Created 2024-05-05 22:41:01">2024-05-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/personal/categories/Learning/">Learning</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/personal/categories/Learning/Arch/">Arch</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/personal/categories/Learning/Arch/Gem5/">Gem5</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>I’ve been trying to simulate a somewhat complicated cache system, and my advisor suggested that i should do it with gem5, which required me to learn this simulator. I’m primarily learning from <a target="_blank" rel="noopener" href="https://www.gem5.org/documentation/learning_gem5/introduction/">the official tutorial</a>. I tried to find blogs that sum up and actually <em>teach</em> gem5, but to no avail – blogs online are mostly rephrasing the official tutorials. So i’m documenting my learning experience with gem5 in the blog series from now on, hopefully in an instructive way. In this blog, I’ll try to sum up the basics of gem5, basically from <a target="_blank" rel="noopener" href="https://www.gem5.org/documentation/learning_gem5/introduction/">Introduction</a> to <a target="_blank" rel="noopener" href="https://www.gem5.org/documentation/learning_gem5/part1/example_configs/">Using the default configuration scripts</a>.</p>
<h1 id="What-gem5-really-is"><a href="#What-gem5-really-is" class="headerlink" title="What gem5 really is"></a>What gem5 really is</h1><p>Gem5 to me is an object-oriented, python-script triggered, cpp driven bulk of files that happen to make up the system simulator that we know. To be more specific, many <strong>objects</strong> are defined and implemented in cpp, and they are imported in python scripts to build the system we desire. The commandline prompt to run a simplest simuation:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build/X86/gem5.opt configs/tutorial/part1/simple.py</span><br></pre></td></tr></table></figure>

<p>is essentially an execution of the <code>.py</code> file, and we can actually add a bunch of trailing args to send into the file, just like we do with python file args. For example, for the very useful <code>se.py</code> file, we have an ocean of arguments to pass to:</p>
<ul>
<li><code>caches</code><br>  Perform the simulation with classic caches.</li>
<li><code>l2cache</code><br>  Perform the simulation with an L2 cache, if using classic caches.</li>
<li><code>-c CMD, --cmd=CMD</code><br>  The binary to run in syscall emulation mode.</li>
<li><code>--output=OUTPUT</code><br>  Redirect stdout to a file. This is useful if you want to redirect the output of the simulated application to a file instead of printing to the screen. Note: to redirect gem5 output, you have to pass a parameter before the configuration script.</li>
<li>…<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></li>
</ul>
<p>So this would definitely make the python scripts less daunting, as it is no more special than the usual python scripts we write. The difficult part here, however, would be to know your way around how to import different objects and use them to build your system. This would require you to have a clear picture of the computer system, and connect your knowledge of the components with the actual objects you import. I would suggest looking at the the following graph from <a target="_blank" rel="noopener" href="https://www.gem5.org/documentation/learning_gem5/part1/cache_config/">here</a>. </p>
<img src="https://www.gem5.org/pages/static/figures/advanced_config.png" alt="computer system" width="500"/>

<p>Read the code, and constantly come back to the graph. You should have a clearer idea of how things work within the common predefined objects in gem5.</p>
<h1 id="A-glimpse-of-the-customizability-of-gem5"><a href="#A-glimpse-of-the-customizability-of-gem5" class="headerlink" title="A glimpse of the customizability of gem5"></a>A glimpse of the customizability of gem5</h1><p>Another characteristic of gem5 is that it provides users with a lot of ways to tweak with their systems. The tutorial offers a very elementary glimpse of this by showing how users can define their own cache using the provided cache objects <a target="_blank" rel="noopener" href="https://www.gem5.org/documentation/learning_gem5/part1/cache_config/">here</a>. Through this example, you learn that you can define objects and utilize the modules in python just like you do with your everyday python coding. </p>
<p>The example above only created derived objects without going into the cpp cores. Later through <a target="_blank" rel="noopener" href="https://www.gem5.org/documentation/learning_gem5/part2/helloobject">this tutorial</a> you will learn to create a brand new object in cpp, and import it into your python code! However, I don’t encourage following it step by step. I’ll explain later.</p>
<h1 id="Carry-out-simple-simulations-with-se-py"><a href="#Carry-out-simple-simulations-with-se-py" class="headerlink" title="Carry out simple simulations with se.py"></a>Carry out simple simulations with <code>se.py</code></h1><h2 id="Understanding-the-arguments"><a href="#Understanding-the-arguments" class="headerlink" title="Understanding the arguments"></a>Understanding the arguments</h2><p>So far, we have followed the tutorial and build a working system. but most of the time we likely wont be patient enough to build from the scrath. This is where the <code>se.py</code> (also the <code>fs.py</code>) file comes in handy. The <code>se.py</code> file can be found under <code>gem5/configs/deprecated/example</code>. By running </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build/X86/gem5.opt configs/deprecated/example/se.py --help</span><br></pre></td></tr></table></figure>

<p>you can learn the details of what the script does. The most important arguments are: <code>cmd</code> (to run binary files with), <code>--cpu-type</code>, cache arguments. It should be noted that some arguments can be tricky. For example, you should explicitly set <code>--caches</code> in </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build/X86/gem5.opt configs/example/se.py --cmd=tests/test-progs/hello/bin/x86/linux/hello --cpu-type=TimingSimpleCPU --l1d_size=64kB --l1i_size=16kB --caches</span><br></pre></td></tr></table></figure>

<p>for the system to actually simulate the cache. You can also refer to the second half of <a target="_blank" rel="noopener" href="https://www.gem5.org/documentation/learning_gem5/part1/example_configs/">example configs</a> in the tutorial.</p>
<h2 id="Understanding-the-statistics-and-outputs"><a href="#Understanding-the-statistics-and-outputs" class="headerlink" title="Understanding the statistics and outputs"></a>Understanding the statistics and outputs</h2><p>Understanding the <code>gem5/m5out/config.ini</code> file is very important for your simulation. For every simulation we do, the <em>actual</em> <sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> configuration you used for that simulation is printed in <code>config.ini</code> by default. Using the “find” feature on you text editor to quicky navigate to the information you want. For example, this is part of the config.ini file, and you would search for “cache_line_size” to ensure that the system used the cache line size you specified. </p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[system]</span><br><span class="line">type=System</span><br><span class="line">children=clk_domain cpu dvfs_handler mem_ctrl membus</span><br><span class="line">boot_osflags=a</span><br><span class="line">cache_line_size=64</span><br><span class="line">clk_domain=system.clk_domain</span><br><span class="line">default_p_state=UNDEFINED</span><br><span class="line">eventq_index=0</span><br><span class="line">exit_on_work_items=false</span><br><span class="line">init_param=0</span><br><span class="line">kernel=</span><br><span class="line">kernel_addr_check=true</span><br><span class="line">kernel_extras=</span><br><span class="line">kvm_vm=Null</span><br><span class="line">load_addr_mask=18446744073709551615</span><br><span class="line">load_offset=0</span><br><span class="line">mem_mode=timing</span><br></pre></td></tr></table></figure>

<p>The <code>gem5/m5out/stats.txt</code> file is equally important. It details the following statistics and more:</p>
<ul>
<li>general statistics: simSeconds (total simulated time), simInsts (total number of instructions simulated)…</li>
<li>SimObjects’ statistics: CPU statistics (cache systems, syscalls) …</li>
<li>controller statistics: bandwidth information, bytes read…</li>
</ul>
<p>Having learned all these basics of the gem5 simulator, you’re now ready to learn how to fashion an object in cpp. That is where it gets real <em>system</em> 😄.</p>
<hr>
<p>I’ll share a playlist featuring some relaxing r&amp;b.</p>
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/5RUSPXkKrBgQkHmBNhKzyI?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">1.</span><span style="display: inline-block; vertical-align: top;">More details can be found <a target="_blank" rel="noopener" href="https://www.gem5.org/documentation/learning_gem5/part1/example_configs/">here</a>.</span><a href="#fnref:1" rev="footnote"> ↩</a></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">2.</span><span style="display: inline-block; vertical-align: top;">As mentioned above, sometimes you don't get the expected configuration even if you think you have configured the system that way.</span><a href="#fnref:2" rev="footnote"> ↩</a></li></ol></div></div></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/personal/tags/gem5/">gem5</a><a class="post-meta__tags" href="/personal/tags/arch/">arch</a></div><div class="post_share"><div class="social-share" data-image="/personal/img/pfp.jpg" data-sites="twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/personal/2024/05/05/JS-needed-for-react/" title="JS-needed-for-react"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">JS-needed-for-react</div></div></a></div><div class="next-post pull-right"><a href="/personal/2024/05/04/hello-world/" title="Hello World"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">Hello World</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/personal/2024/05/10/gem5-objects/" title="Gem5 Objects"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-10</div><div class="title">Gem5 Objects</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#What-gem5-really-is"><span class="toc-number">1.</span> <span class="toc-text">What gem5 really is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A-glimpse-of-the-customizability-of-gem5"><span class="toc-number">2.</span> <span class="toc-text">A glimpse of the customizability of gem5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Carry-out-simple-simulations-with-se-py"><span class="toc-number">3.</span> <span class="toc-text">Carry out simple simulations with se.py</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Understanding-the-arguments"><span class="toc-number">3.1.</span> <span class="toc-text">Understanding the arguments</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Understanding-the-statistics-and-outputs"><span class="toc-number">3.2.</span> <span class="toc-text">Understanding the statistics and outputs</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: rgb(0,0,0,0)"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/personal/js/utils.js?v=4.13.0"></script><script src="/personal/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div></div></body></html>